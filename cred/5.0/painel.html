<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gestor de Taxas</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Estilo da Logo */
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-img { max-width: 180px; height: auto; }

        h1, h3 { text-align: center; color: var(--primary); margin-top: 10px; }
        label { display: block; font-weight: bold; margin-top: 15px; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        
        .planos-botoes { display: flex; gap: 10px; margin: 20px 0; }
        .plano-btn { flex: 1; padding: 12px; border: 2px solid #ddd; background: #f9f9f9; cursor: pointer; font-weight: bold; border-radius: 6px; transition: 0.3s; }
        .plano-btn.active { border-color: var(--primary); background: #e7f3ff; color: var(--primary); }
        
        .grid-taxas { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; margin-top: 20px; }
        .taxa-item { background: #fff; padding: 10px; border: 1px solid #eee; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .taxa-item label { margin-top: 0; font-size: 0.85em; color: #666; }

        .btn-salvar { width: 100%; padding: 18px; background-color: var(--success); color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 30px; transition: 0.3s; }
        .btn-salvar:hover { background-color: #218838; transform: translateY(-2px); }

        .rep-list { margin-top: 40px; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
        .rep-link-card { display: block; padding: 15px; background: #fff; border: 2px solid #eee; border-radius: 8px; text-align: center; text-decoration: none; color: #333; font-weight: bold; transition: 0.3s; }
        .rep-link-card:hover { border-color: var(--primary); background: #f0f7ff; color: var(--primary); }
        
        #mensagem { text-align: center; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="logo-container">
        <img src="logo.jpg" alt="Logo" class="logo-img">
    </div>
    
    <h1>üõ†Ô∏è Painel Administrativo</h1>

    <label>Selecione o Representante:</label>
    <select id="repSelect" onchange="carregarConfiguracao()">
        <script>
            for (let i = 1; i <= 12; i++) document.write(`<option value="${i}">Representante ${i}</option>`);
        </script>
    </select>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px;">
        <div>
            <label>üë§ Nome Exibido:</label>
            <input type="text" id="repNome" placeholder="Ex: Jo√£o Consultoria">
        </div>
        <div>
            <label>üì± WhatsApp:</label>
            <input type="text" id="repWhatsapp" placeholder="Ex: 5511999999999">
        </div>
    </div>
    
    <label>üèôÔ∏è Cidade:</label>
    <input type="text" id="repCidade" placeholder="Ex: Montes Claros - MG">

    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

    <h3>Configura√ß√£o de Taxas</h3>
    <div class="planos-botoes">
        <button class="plano-btn" id="btnP1" onclick="mudarPlanoVisual(1)">Plano 1</button>
        <button class="plano-btn" id="btnP2" onclick="mudarPlanoVisual(2)">Plano 2</button>
        <button class="plano-btn" id="btnP3" onclick="mudarPlanoVisual(3)">Plano 3</button>
        <button class="plano-btn" id="btnP4" onclick="mudarPlanoVisual(4)">Plano 4</button>
    </div>

    <div style="background: #fafafa; padding: 20px; border-radius: 8px; border: 1px solid #eee;">
        <h4 id="txtEditando" style="margin-top:0">Editando Plano 1</h4>
        <label>‚ûï Taxa Fixa Adicional (R$):</label>
        <input type="number" id="taxaFixa" step="0.01" value="0.00">

        <div class="grid-taxas">
            <div class="taxa-item">
                <label>D√©bito (%)</label>
                <input type="number" id="t_debito" step="0.01" value="0.00">
            </div>
            <script>
                for(let i=1; i<=18; i++) {
                    document.write(`<div class="taxa-item"><label>${i}X (%)</label><input type="number" id="t_${i}x" step="0.01" value="0.00"></div>`);
                }
            </script>
        </div>
    </div>

    <button class="btn-salvar" onclick="salvarDados()">üíæ SALVAR ALTERA√á√ïES NA PLANILHA</button>
    <div id="mensagem"></div>

    <h3 style="margin-top: 50px;">üîó Links das P√°ginas de Simula√ß√£o</h3>
    <div id="containerLinks" class="rep-list"></div>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbx_kZOvD2vxIRKZkCJCdnmx2-bN4ee1Z-95FJuyImXHKYai2rdNadz_cjQLIMgZCigN/exec';
    let cacheDadosReps = [];
    let dadosRepAtual = {};
    let planoAtivoSendoEditado = 1;

    function getColunaKey(tipo, plano) {
        if (tipo === 'debito') return `Debito_${plano}`;
        if (tipo === 'fixa') return `TaxaFixa_${plano}`;
        return `${tipo.toUpperCase()}_${plano}`;
    }

    async function carregarConfiguracao() {
        const id = document.getElementById('repSelect').value;
        const msg = document.getElementById('mensagem');
        msg.innerHTML = "‚è≥ Sincronizando...";
        
        try {
            const resp = await fetch(API_URL);
            cacheDadosReps = await resp.json();
            atualizarListaLinks();

            const rep = cacheDadosReps.find(r => r.RepId == id);
            if (rep) {
                dadosRepAtual = rep;
                document.getElementById('repNome').value = rep.Nome || "";
                document.getElementById('repWhatsapp').value = rep.Whatsapp || "";
                document.getElementById('repCidade').value = rep.Cidade || "";
                mudarPlanoVisual(rep.PlanoAtivo || 1);
                msg.innerHTML = "‚úÖ Pronto.";
            }
        } catch (e) { msg.innerHTML = "‚ùå Erro de conex√£o."; }
    }

    function mudarPlanoVisual(p) {
        planoAtivoSendoEditado = p;
        document.querySelectorAll('.plano-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btnP' + p).classList.add('active');
        document.getElementById('txtEditando').innerText = `Editando Plano ${p}`;
        document.getElementById('taxaFixa').value = dadosRepAtual[getColunaKey('fixa', p)] || 0;
        document.getElementById('t_debito').value = dadosRepAtual[getColunaKey('debito', p)] || 0;
        for(let i=1; i<=18; i++) {
            document.getElementById(`t_${i}x`).value = dadosRepAtual[getColunaKey(`${i}x`, p)] || 0;
        }
    }

    function atualizarListaLinks() {
        const container = document.getElementById('containerLinks');
        container.innerHTML = '';
        for (let i = 1; i <= 12; i++) {
            const rep = cacheDadosReps.find(r => r.RepId == i);
            const nome = (rep && rep.Nome) ? rep.Nome : `Representante ${i}`;
            container.innerHTML += `<a href="rep_${i}.html" target="_blank" class="rep-link-card">üîó ${nome}</a>`;
        }
    }

    async function salvarDados() {
        const id = document.getElementById('repSelect').value;
        const msg = document.getElementById('mensagem');
        msg.innerHTML = "‚è≥ Salvando...";

        const payload = {
            RepId: parseInt(id),
            Nome: document.getElementById('repNome').value,
            Whatsapp: document.getElementById('repWhatsapp').value,
            Cidade: document.getElementById('repCidade').value,
            PlanoAtivo: planoAtivoSendoEditado
        };

        payload[getColunaKey('fixa', planoAtivoSendoEditado)] = parseFloat(document.getElementById('taxaFixa').value);
        payload[getColunaKey('debito', planoAtivoSendoEditado)] = parseFloat(document.getElementById('t_debito').value);
        for(let i=1; i<=18; i++) {
            payload[getColunaKey(`${i}x`, planoAtivoSendoEditado)] = parseFloat(document.getElementById(`t_${i}x`).value);
        }

        try {
            await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
            msg.innerHTML = "‚úÖ DADOS ATUALIZADOS!";
            carregarConfiguracao();
        } catch (e) { msg.innerHTML = "‚ùå Erro ao salvar."; }
    }
    window.onload = carregarConfiguracao;
</script>
</body>

</html>
